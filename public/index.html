<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SpaceNote</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h1>Welcome to Space Note</h1>
    <p>Create your own space and come back later.</p>
    <button id="create-space-button" onclick="handleCreateSpace()">Create New Space</button>
    <div id="space-link"></div>

    <script>
      function handleCreateSpace() {
        const button = document.getElementById("create-space-button");
        button.disabled = true;

        const spaceObject = createSpaceObject();
        displaySpaceLink(spaceObject);
      }

      function createSpaceObject() {
        const spaceId = Math.random().toString(36).substr(2, 9);
        const url = `${window.location.origin}/space/${spaceId}`;
        return { spaceId: spaceId, url: url };
      }

      function displaySpaceLink(spaceObject) {
        const link = document.createElement("a");
        link.href = spaceObject.url;
        link.textContent = "Go to your new space";
        link.style.display = "block";
        link.style.marginTop = "20px";

        link.addEventListener("click", function (event) {
          event.preventDefault(); // Prevent default link behavior
          createSpace(spaceObject.spaceId).then(() => {
            window.location.href = spaceObject.url; // Redirect after space is created
          });
        });

        const container = document.getElementById("space-link");
        container.innerHTML = "";
        container.appendChild(link);
      }

      function createSpace(spaceId) {
        return fetch("/clicked", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ spaceName: spaceId }),
        })
        .then((response) => response.json())
        .then((data) => {
          console.log("Success:", data);
        })
        .catch((error) => {
          console.error("Error:", error);
        });
      }
    </script>
  </body>
</html>
